"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),fnnAutocomplete=function(){function t(e){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,t);var i=this;this.opts=Object.assign({key:"",timeout:50,data:[],chache:!0,autoSelect:!0,autoOpen:!0,menuClass:"",minLength:0,loader:!1,closeBtn:!0,limit:3,noFound:"Не найдено"},s);var o=crEl("div",{c:"fnn-autocomplete-container"});e.parentNode.insertBefore(o,e),e=e.parentElement.removeChild(e),e.classList.contains("fnn-autocomplete")||e.classList.add("fnn-autocomplete"),o.appendChild(e),0!=this.opts.closeBtn&&(this.closeBtn=crEl("button",{c:"fnn-autocomplete-close",e:{click:function(){i.clear()}}},"×"),o.appendChild(this.closeBtn)),0!=this.opts.loader&&(this.loader=crEl("div",{c:"fnn-autocomplete-loader"},crEl("div",{c:"fnn-autocomplete-loader-pct"})),o.appendChild(this.loader)),this.results=crEl("ul",{c:"fnn-autocomplete-results"}),o.appendChild(this.results);var n=null;return e.addEventListener("input",function(){var t=this.value.trim();t.length<=i.opts.minLength&&i.opts.source&&"function"==typeof i.opts.source&&(i.opts.data=[]),t.length>i.opts.minLength&&(n&&clearTimeout(n),n=setTimeout(function(){i.search(t)},i.opts.timeout))},!1),e.addEventListener("focus",function(){i.selected&&(this.select(),this.focus()),i.opts.autoOpen&&i.search("%")},!1),e.addEventListener("blur",function(){setTimeout(function(){i._close()},500)},!1),e.addEventListener("keydown",function(t){if(13===t.keyCode)i.results.querySelector(".active")?i.results.querySelector(".active").click():(el=i.results.childNodes[0],el&&el.click());else{if(38===t.keyCode){t.preventDefault();var e=i.results.querySelector(".active");return void(e?e.previousSibling?(e.classList.remove("active"),e.previousSibling.classList.add("active")):(e.classList.remove("active"),i.results.childNodes[i.results.childNodes.length-1].classList.add("active")):i.results.childNodes[i.results.childNodes.length-1].classList.add("active"))}if(40===t.keyCode){if(t.preventDefault(),i.results.childNodes.length>0){var s=i.results.querySelector(".active");s?s.nextSibling?(s.classList.remove("active"),s.nextSibling.classList.add("active")):(s.classList.remove("active"),i.results.childNodes[0].classList.add("active")):i.results.childNodes[0].classList.add("active")}return}}}),i.input=e,i}return _createClass(t,[{key:"_open",value:function(){}},{key:"_close",value:function(){this.results.innerHTML=null}},{key:"clear",value:function(){this.selected=!0,this.input.value="",this.input.focus(),this.closeBtn&&this.closeBtn.classList.remove("active"),this.opts.source&&"function"==typeof this.opts.source&&(this.opts.data=[])}},{key:"select",value:function(t){this._close(),this.selected=!0,this.input.blur(),this.closeBtn&&this.closeBtn.classList.add("active"),"function"==typeof this.opts.onSelect&&this.opts.onSelect(t)}},{key:"render",value:function(t){var e=this,s=t;this.opts.key&&this.opts.key.length&&(s=t[this.opts.key]);var i=crEl("li",s);return this.opts.render&&(i=this.opts.render(t)),i.addEventListener("click",function(){e.input.value=s,e.select(t)}),i.addEventListener("mousemove",function(){this.parentNode.querySelectorAll(".active").forEach(function(t){t.classList.remove("active")}),this.classList.add("active")},!1),i}},{key:"_search",value:function(t){var e=this;e.selected=!1,this.results.innerHTML=null;var s=0;this.opts.data&&this.opts.data.length?(this.opts.data.forEach(function(i){var o=i;if(e.opts.key&&e.opts.key.length&&(o=i[e.opts.key]),e.opts.limit&&e.opts.limit>0&&e.opts.limit>s&&("%"==t||o.toLowerCase().indexOf(t.toLowerCase().trim())!=-1)){var n=e.render(i);e.opts.autoSelect&&0==s&&n.classList.add("active"),e.results.appendChild(n),s++}}),0==s&&this.results.appendChild(crEl("li",this.opts.noFound))):this.results.appendChild(crEl("li",this.opts.noFound))}},{key:"search",value:function(t){var e=this;this.opts.chache&&this.opts.data.length>0||!this.opts.source||"function"!=typeof this.opts.source?e._search(t):(this.opts.loader&&this.loader.classList.add("active"),this.opts.source(t,function(s){e.opts.loader&&e.loader.classList.remove("active"),e.opts.data=s,e._search(t)}))}}]),t}();
//# sourceMappingURL=fnn-autocomplete.js.map
